<!DOCTYPE html>
<html>
<head>
    <title>Results Page</title>
    <script src="pricePredict.js"></script>
</head>
<body>
     <!-- Display form data -->
     <h2>Form Data:</h2>
     <div id="formData"></div>

    <div class="predicted-price-section">
        <h2>Predicted Price:</h2>
        <span id="predicted-price">Rs 0</span>
      </div>
      
    <h1>Top 5 Houses</h1>
    <ul id="houseList"></ul>

   <!-- <img src="https://i.pinimg.com/564x/81/c1/87/81c18773eed133f81cb036e2f144eae7.jpg" alt="" height="500px" width="500px"> -->

    <!-- Display top 5 houses -->
    <h2>Top 5 Houses</h2>
    <div id="top5Houses">
        <!-- Display top 5 houses here -->
    </div>

    <!-- Display the rest of the house list -->
    <!-- Add this HTML code to create a container for the "rest of the houses" -->
<div id="restOfHousesContainer" class="rest-of-houses-container">
    <!-- The dynamic house cards will be inserted here -->
</div>


    <script>
        let houseType, housePrice, locationValue, selectedAmenities;
        let houseImagesData, top5Houses, uniqueHouseList;

        // Fetch the JSON data from the server
        fetch('http://localhost:8080', { method: 'GET', })
        .then(response => {
        console.log('Received response');
        return response.json();
    })
            .then(data => {
                console.log('Received data:', data); // Add this line
                if (data.user_preferences) {
                houseType = data.user_preferences.houseType;
                housePrice = data.user_preferences.housePrice;
                locationValue = data.user_preferences.location; // Updated variable name
                selectedAmenities = data.user_preferences.selectedAmenities;
            }

            if (data.house_images_data) {
                houseImagesData = data.house_images_data;
            }

            if (data.top_5_houses) {
                top5Houses = data.top_5_houses;
            }

            if (data.unique_house_list) {
                uniqueHouseList = data.unique_house_list;
            }
            const houseImagesMap = {};

// Populate the houseImagesMap using houseImagesData
for (const image of houseImagesData) {
    const houseId = image.house_id;
    if (!houseImagesMap[houseId]) {
        houseImagesMap[houseId] = [];
    }
    houseImagesMap[houseId].push(image);
}

// Step 2: Update uniqueHouseList with associated images
for (const house of uniqueHouseList) {
    const houseId = house.house_id;
    if (houseImagesMap[houseId]) {
        house.images = houseImagesMap[houseId];
    }
}

            //Console log form data
            console.log('House Type:', houseType);
            console.log('House Price:', housePrice);
            console.log('Location:', locationValue);
            console.log('Selected Amenities:', selectedAmenities);
            //Console log house image data, top 5 houses, and all houses
            console.log('House Images Data:', houseImagesData);
            console.log('Top 5 Houses:', top5Houses);
            console.log('Unique House List:', uniqueHouseList);
            ;

                // Display top 5 houses
const top5HousesDiv = document.getElementById('top5Houses');
data.top_5_houses.forEach(houseId => {
    // Create a panel for each top house
    const housePanel = document.createElement('div');
    housePanel.classList.add('house-panel');
    
    // Find the house data in unique_house_list based on houseId
    const houseData = data.unique_house_list.find(house => house.house_id === houseId);
    
    if (houseData) {
        // Create elements to display house information
        const houseName = document.createElement('h3');
        houseName.textContent = houseData.house_name;

        const houseType = document.createElement('p');
        houseType.textContent = `House Type: ${houseData.house_type}`;

        const priceRange = document.createElement('p');
        priceRange.textContent = `Price Range: ${houseData.price_range}`;

        const location = document.createElement('p');
        location.textContent = `Location: ${houseData.location}`;

        const amenities = document.createElement('p');
        amenities.textContent = `Amenities: ${houseData.has_pool ? 'Pool, ' : ''}${houseData.has_gym ? 'Gym, ' : ''}${houseData.has_fireplace ? 'Fireplace, ' : ''}${houseData.has_yard ? 'Yard, ' : ''}${houseData.has_garage ? 'Garage' : ''}`;
        
        // Append the elements to the housePanel
        housePanel.appendChild(houseName);
        housePanel.appendChild(houseType);
        housePanel.appendChild(priceRange);
        housePanel.appendChild(location);
        housePanel.appendChild(amenities);

        // Append the housePanel to the top5HousesDiv
        top5HousesDiv.appendChild(housePanel);
    }
});

               // Get the container element where you want to display the houses
const restOfHousesContainer = document.getElementById('restOfHousesContainer'); // Replace with the actual container ID or selector

// Loop through the uniqueHouseList
for (const house of uniqueHouseList) {
    // Create a card element for each house
    const card = document.createElement('div');
    card.classList.add('card'); // You can add CSS classes for styling

    // Create an image element for the house's exterior image (assuming you have an "images" property)
    if (house.images && house.images.length > 0) {
        const image = document.createElement('img');
        image.src = house.images[0].image_url; // Assuming the first image is the exterior image
        image.alt = house.house_name; // Set alt text for accessibility
        card.appendChild(image);
    }

    // Create a title element for the house's name
    const title = document.createElement('h2');
    title.textContent = house.house_name;
    card.appendChild(title);

    // Create other elements to display additional information (house type, location, etc.)
    // You can customize this part based on your data structure

    // Append the card to the container
    restOfHousesContainer.appendChild(card);
}
            })
            .catch(error => console.error('Error:', error));
    </script>
</body>
</html>
